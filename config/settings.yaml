app:
  name: "Tiger Trafficking Investigation System"
  version: "1.0.0"
  environment: ${APP_ENV:-development}
  debug: ${DEBUG:-false}
  secret_key: ${SECRET_KEY}
  
database:
  url: ${DATABASE_URL:-sqlite:///data/production.db}
  pool_size: 10
  max_overflow: 20
  echo: ${DEBUG:-false}
  # SQLite configuration
  sqlite_path: ${SQLITE_DB_PATH:-data/production.db}
  use_sqlite_demo: ${USE_SQLITE_DEMO:-false}
  use_postgresql: ${USE_POSTGRESQL:-false}

redis:
  url: ${REDIS_URL}
  decode_responses: true

storage:
  type: ${STORAGE_TYPE:-local}  # local, s3, minio
  local_path: ${STORAGE_PATH:-./data/storage}
  s3_bucket: ${S3_BUCKET}
  s3_region: ${S3_REGION}
  
authentication:
  jwt_secret_key: ${JWT_SECRET_KEY}
  jwt_algorithm: ${JWT_ALGORITHM:-HS256}
  jwt_expiration_hours: ${JWT_EXPIRATION_HOURS:-24}
  mfa_enabled: ${MFA_ENABLED:-false}
  password_min_length: 8
  
modal:
  # Modal configuration for serverless GPU compute
  enabled: ${MODAL_ENABLED:-true}
  app_name: "tiger-id-models"
  max_retries: ${MODAL_MAX_RETRIES:-3}
  retry_delay: ${MODAL_RETRY_DELAY:-1.0}
  timeout: ${MODAL_TIMEOUT:-120}
  queue_max_size: ${MODAL_QUEUE_MAX_SIZE:-100}
  # Fallback behavior when Modal unavailable
  fallback_to_queue: ${MODAL_FALLBACK_TO_QUEUE:-true}

firecrawl:
  api_key: ${FIRECRAWL_API_KEY}
  timeout: 30
  
models:
  detection:
    path: ${MEGADETECTOR_MODEL_PATH:-./data/models/md_v5a.0.0.pt}
    version: ${MEGADETECTOR_VERSION:-v5}
    confidence_threshold: 0.5
    nms_threshold: 0.45
    enabled: true
  reid:
    path: ${REID_MODEL_PATH:-./data/models/tiger_reid_model.pth}
    similarity_threshold: 0.8
    embedding_dim: 2048
  rapid:
    path: ${RAPID_MODEL_PATH:-./data/models/rapid/checkpoints/model.pth}
    similarity_threshold: 0.8
    enabled: ${RAPID_ENABLED:-false}
  wildlife_tools:
    path: ${WILDLIFETOOLS_MODEL_PATH:-./data/models/wildlife-tools/}
    model_type: ${WILDLIFETOOLS_MODEL_TYPE:-megadescriptor}
    similarity_threshold: 0.8
    enabled: ${WILDLIFETOOLS_ENABLED:-false}
  cvwc2019:
    path: ${CVWC2019_MODEL_PATH:-./data/models/cvwc2019/checkpoints/model.pth}
    similarity_threshold: 0.8
    enabled: ${CVWC2019_ENABLED:-false}
  pose:
    path: ${POSE_MODEL_PATH:-./data/models/tiger_pose_model.pth}
    enabled: true
  device: ${MODEL_DEVICE:-cuda}
  batch_size: ${BATCH_SIZE:-32}
  preload_on_startup: ${MODEL_PRELOAD_ON_STARTUP:-false}
  cache_ttl: ${MODEL_CACHE_TTL:-3600}
  max_batch_size: ${MAX_BATCH_SIZE:-50}
  
datasets:
  atrw:
    path: ${ATRW_DATASET_PATH:-./data/models/atrw/}
  metawild:
    path: ${METAWILD_DATASET_PATH:-./data/datasets/metawild/}
  wildlife_datasets:
    path: ${WILDLIFE_DATASETS_PATH:-./data/datasets/wildlife-datasets/}
  individual_animal_reid:
    path: ${INDIVIDUAL_ANIMAL_REID_PATH:-./data/datasets/individual-animal-reid/}
  # TPC Facilities Excel file
  tpc_facilities_excel:
    path: ${TPC_FACILITIES_EXCEL_PATH:-./data/datasets/2025_10_31 TPC_Tigers non-accredited facilities.xlsx}
  
monitoring:
  prometheus_enabled: ${PROMETHEUS_ENABLED:-true}
  prometheus_port: ${PROMETHEUS_PORT:-9090}
  log_level: ${LOG_LEVEL:-INFO}

auto_investigation:
  # Master switch for auto-triggered investigations from discovery pipeline
  enabled: ${AUTO_INVESTIGATION_ENABLED:-true}

  # Quality gates - higher thresholds than general pipeline to reduce noise
  min_quality_score: ${AUTO_INVESTIGATION_MIN_QUALITY:-60.0}  # 0-100 scale
  min_detection_confidence: ${AUTO_INVESTIGATION_MIN_CONFIDENCE:-0.85}  # 0-1 scale

  # Rate limiting to prevent investigation spam
  max_per_hour: ${AUTO_INVESTIGATION_MAX_PER_HOUR:-5}
  min_facility_interval_seconds: ${AUTO_INVESTIGATION_FACILITY_INTERVAL:-3600}  # 1 hour

  # Async behavior
  always_async: true  # Auto-investigations always run in background
  use_duckduckgo_deep_research: true  # Use free DuckDuckGo (not Claude web search)

  # Priority mapping based on detection confidence
  priority_mapping:
    high: 0.95
    medium: 0.85
    low: 0.70

verification_queue:
  # All tigers go to pending review - both auto-discoveries AND user uploads
  user_uploads_status: "pending"
  auto_discovery_status: "pending"
  require_human_review: true

  # Priority defaults by source
  user_upload_priority: "medium"
  auto_discovery_high_confidence_priority: "high"  # >= 85% confidence
  auto_discovery_default_priority: "medium"

langgraph:
  enabled: ${USE_LANGGRAPH:-false}
  checkpoint: memory
  thread_id_prefix: investigation_
  
external_apis:
  usda:
    api_key: ${USDA_API_KEY}
    enabled: false
  cites:
    api_key: ${CITES_API_KEY}
    enabled: false
  usfws:
    api_key: ${USFWS_API_KEY}
    enabled: false
  youtube:
    api_key: ${YOUTUBE_API_KEY}
    enabled: false
    base_url: https://www.googleapis.com/youtube/v3
    timeout: 30
  meta:
    access_token: ${META_ACCESS_TOKEN}
    app_id: ${META_APP_ID}
    app_secret: ${META_APP_SECRET}
    enabled: false
    base_url: https://graph.facebook.com/v19.0
    timeout: 30
    api_version: v19.0

